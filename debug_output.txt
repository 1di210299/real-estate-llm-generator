INFO 2026-01-16 16:16:35,273 scraper ğŸ”§ Scraper initialized - Residential proxy: âŒ Not configured
INFO 2026-01-16 16:16:35,273 scraper ğŸ” [SCRAPE DECISION] Starting method selection for: https://skyadventures.travel/tickets/
INFO 2026-01-16 16:16:35,273 scraper ğŸ” [SCRAPFLY CHECK] Domain: skyadventures.travel
INFO 2026-01-16 16:16:35,273 scraper ğŸ” [SCRAPFLY CHECK] Enabled: True
INFO 2026-01-16 16:16:35,273 scraper ğŸ” [SCRAPFLY CHECK] Client available: False
WARNING 2026-01-16 16:16:35,273 scraper âŒ [SCRAPFLY] Not available - enabled=True, client=False
INFO 2026-01-16 16:16:35,273 scraper âœ… [DECISION] Trying httpx first (simple scraping): https://skyadventures.travel/tickets/
INFO 2026-01-16 16:16:35,273 scraper Scraping with httpx: https://skyadventures.travel/tickets/
INFO 2026-01-16 16:16:35,582 _client HTTP Request: GET https://skyadventures.travel/tickets/ "HTTP/1.1 200 OK"
INFO 2026-01-16 16:16:35,594 content_detection ================================================================================
INFO 2026-01-16 16:16:35,594 content_detection ğŸ” Starting hybrid content type detection
INFO 2026-01-16 16:16:35,594 content_detection ================================================================================
INFO 2026-01-16 16:16:35,594 content_detection ğŸ” Detecting by domain: skyadventures.travel
INFO 2026-01-16 16:16:35,594 content_detection âš ï¸ No domain match for: skyadventures.travel
INFO 2026-01-16 16:16:35,606 content_detection ğŸ” Detecting by keywords (text length: 3079 chars)
DEBUG 2026-01-16 16:16:35,607 content_detection   real_estate: 0/25 keywords (0.00%)
DEBUG 2026-01-16 16:16:35,607 content_detection   tour: 3/20 keywords (15.00%)
DEBUG 2026-01-16 16:16:35,607 content_detection   restaurant: 0/20 keywords (0.00%)
DEBUG 2026-01-16 16:16:35,607 content_detection   local_tips: 2/19 keywords (10.53%)
DEBUG 2026-01-16 16:16:35,607 content_detection   transportation: 1/22 keywords (4.55%)
INFO 2026-01-16 16:16:35,607 content_detection ğŸ† Best keyword match: tour (3 keywords, 15.00% confidence)
INFO 2026-01-16 16:16:35,607 content_detection âš ï¸ Keyword confidence below threshold (30.00%)
WARNING 2026-01-16 16:16:35,607 content_detection âš ï¸ No detection method succeeded, defaulting to real_estate
INFO 2026-01-16 16:16:35,607 page_type_detection ================================================================================
INFO 2026-01-16 16:16:35,607 page_type_detection ğŸ” Starting cascading page type detection
INFO 2026-01-16 16:16:35,607 page_type_detection    URL: https://skyadventures.travel/tickets/
INFO 2026-01-16 16:16:35,607 page_type_detection    Content type: real_estate
INFO 2026-01-16 16:16:35,607 page_type_detection ================================================================================
INFO 2026-01-16 16:16:35,607 page_type_detection ğŸ“ LEVEL 1: Analyzing URL patterns...
INFO 2026-01-16 16:16:35,607 page_type_detection 
------------------------------------------------------------
INFO 2026-01-16 16:16:35,607 page_type_detection ğŸ” URL PATTERN ANALYSIS
INFO 2026-01-16 16:16:35,607 page_type_detection ------------------------------------------------------------
INFO 2026-01-16 16:16:35,607 page_type_detection Domain: skyadventures.travel
INFO 2026-01-16 16:16:35,608 page_type_detection Path: /tickets/
INFO 2026-01-16 16:16:35,608 page_type_detection 
ğŸ” Checking for SPECIFIC page indicators...
INFO 2026-01-16 16:16:35,608 page_type_detection    âŒ No Viator ID (d742-XXX)
INFO 2026-01-16 16:16:35,608 page_type_detection    âŒ No GetYourGuide ID (tXXXX)
INFO 2026-01-16 16:16:35,608 page_type_detection    âŒ No 5+ digit ID
INFO 2026-01-16 16:16:35,608 page_type_detection    âŒ No listing-ID pattern
INFO 2026-01-16 16:16:35,608 page_type_detection 
ğŸ“ Path depth: 1 levels
INFO 2026-01-16 16:16:35,608 page_type_detection    âŒ Shallow path (1 < 4)
INFO 2026-01-16 16:16:35,608 page_type_detection 
ğŸ” Checking for GENERAL page indicators...
INFO 2026-01-16 16:16:35,608 page_type_detection    âŒ Doesn't end in plural
INFO 2026-01-16 16:16:35,608 page_type_detection    âŒ Not a category page
INFO 2026-01-16 16:16:35,608 page_type_detection    âŒ No search/browse pattern
INFO 2026-01-16 16:16:35,608 page_type_detection    Result: specific
INFO 2026-01-16 16:16:35,609 page_type_detection    Confidence: 50%
INFO 2026-01-16 16:16:35,609 page_type_detection    Reason: URL pattern inconclusive, defaulting to specific
INFO 2026-01-16 16:16:35,609 page_type_detection âš ï¸ LOW/MEDIUM confidence from URL - CONTINUING TO LEVEL 2...
INFO 2026-01-16 16:16:35,609 page_type_detection 
INFO 2026-01-16 16:16:35,609 page_type_detection ğŸ“Š LEVEL 2: Analyzing HTML preview with LLM...
INFO 2026-01-16 16:16:35,609 page_type_detection \n------------------------------------------------------------
INFO 2026-01-16 16:16:35,609 page_type_detection ğŸ“Š HTML STRUCTURE ANALYSIS
INFO 2026-01-16 16:16:35,609 page_type_detection ------------------------------------------------------------
INFO 2026-01-16 16:16:35,616 page_type_detection HTML size: 120,434 characters
INFO 2026-01-16 16:16:35,616 page_type_detection Content type: real_estate
INFO 2026-01-16 16:16:35,616 page_type_detection \nğŸ”¢ Counting item cards...
INFO 2026-01-16 16:16:35,620 page_type_detection    Found: 20 cards
INFO 2026-01-16 16:16:35,620 page_type_detection    âœ… GENERAL indicator: 20 cards (score +3)
INFO 2026-01-16 16:16:35,620 page_type_detection 
ğŸ’³ Checking booking elements...
INFO 2026-01-16 16:16:35,620 page_type_detection    Found: 2 booking keywords
INFO 2026-01-16 16:16:35,620 page_type_detection    âœ… SPECIFIC indicator: Multiple booking elements (score +3)
INFO 2026-01-16 16:16:35,620 page_type_detection 
ğŸ” Checking filter/navigation elements...
INFO 2026-01-16 16:16:35,620 page_type_detection    Found: 0 filter keywords
INFO 2026-01-16 16:16:35,620 page_type_detection    âŒ Not enough filter elements
INFO 2026-01-16 16:16:35,620 page_type_detection 
ğŸ“Š Checking pagination...
INFO 2026-01-16 16:16:35,620 page_type_detection    Found: 1 pagination keywords
INFO 2026-01-16 16:16:35,620 page_type_detection    âŒ No pagination detected
INFO 2026-01-16 16:16:35,620 page_type_detection \nğŸ¯ FINAL SCORING:
INFO 2026-01-16 16:16:35,620 page_type_detection    SPECIFIC score: 3
INFO 2026-01-16 16:16:35,620 page_type_detection    GENERAL score: 3
INFO 2026-01-16 16:16:35,620 page_type_detection    Indicators: ['Found 20 item cards', 'Found 2 booking elements']
INFO 2026-01-16 16:16:35,620 page_type_detection    âš–ï¸ TIE (score: 3 == 3)
INFO 2026-01-16 16:16:35,621 page_type_detection    âœ… TIEBREAKER: GENERAL (20 cards is strong listing indicator)
INFO 2026-01-16 16:16:35,621 page_type_detection    Final confidence: 60% (tie broken by card count)
INFO 2026-01-16 16:16:35,621 page_type_detection ------------------------------------------------------------
INFO 2026-01-16 16:16:35,621 page_type_detection    Result: general
INFO 2026-01-16 16:16:35,621 page_type_detection    Confidence: 60%
INFO 2026-01-16 16:16:35,621 page_type_detection    Reason: Tie broken by 20 cards (listing indicator)
INFO 2026-01-16 16:16:35,621 page_type_detection 
INFO 2026-01-16 16:16:35,621 page_type_detection ğŸ”€ COMBINING SIGNALS:
INFO 2026-01-16 16:16:35,621 page_type_detection    URL says: specific (50%)
INFO 2026-01-16 16:16:35,621 page_type_detection    HTML says: general (60%)
INFO 2026-01-16 16:16:35,621 page_type_detection    âš ï¸ HTML signal stronger than URL â†’ Using HTML: general
INFO 2026-01-16 16:16:35,621 page_type_detection    Final confidence: 60%
INFO 2026-01-16 16:16:35,621 page_type_detection 
INFO 2026-01-16 16:16:35,621 page_type_detection âš ï¸ LOW CONFIDENCE (60%) - ESCALATING TO LEVEL 3...
INFO 2026-01-16 16:16:35,621 page_type_detection 
INFO 2026-01-16 16:16:35,621 page_type_detection 
============================================================
INFO 2026-01-16 16:16:35,621 page_type_detection ğŸ¤– LEVEL 3: OpenAI Analysis
INFO 2026-01-16 16:16:35,621 page_type_detection ============================================================
INFO 2026-01-16 16:16:35,621 page_type_detection Analyzing 8,000 characters with OpenAI...
INFO 2026-01-16 16:16:35,621 page_type_detection Content type: real_estate
INFO 2026-01-16 16:16:39,691 _client HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
INFO 2026-01-16 16:16:39,704 page_type_detection 
âœ… OpenAI Analysis Complete:
INFO 2026-01-16 16:16:39,704 page_type_detection    Page Type: general
INFO 2026-01-16 16:16:39,704 page_type_detection    Confidence: 85%
INFO 2026-01-16 16:16:39,704 page_type_detection    Reasoning: The page appears to be a listing or guide page for booking experiences in Costa Rica, likely featuring multiple options rather than a single specific item.
INFO 2026-01-16 16:16:39,704 page_type_detection    Key Indicators: multiple experiences available, no detailed descriptions for a single item, likely includes a booking interface for various options
INFO 2026-01-16 16:16:39,705 page_type_detection    Time: 4.08s
INFO 2026-01-16 16:16:39,705 page_type_detection    Cost: $0.0048
INFO 2026-01-16 16:16:39,705 page_type_detection    Tokens: 3168
INFO 2026-01-16 16:16:39,705 page_type_detection ============================================================
INFO 2026-01-16 16:16:39,705 page_type_detection âœ… OpenAI AGREES with Level 2 â†’ general
INFO 2026-01-16 16:16:39,705 extraction ğŸ”‘ OPENAI_API_KEY configured: Yes
INFO 2026-01-16 16:16:39,705 extraction ğŸ”‘ API Key length: 164 chars
INFO 2026-01-16 16:16:39,705 extraction ğŸ”‘ API Key preview: sk-proj-ex...
INFO 2026-01-16 16:16:39,711 extraction ğŸ“ Extractor initialized for content type: real_estate, page type: general
INFO 2026-01-16 16:16:39,726 extraction Prompt preview (first 800 chars): You are a real estate market guide extraction specialist. This appears to be a GENERAL GUIDE page (not a single property), so extract overview information about the real estate market.

**Instructions:**
1. Extract general information about the real estate market and available properties
2. DO NOT try to extract details of a single property (this is a guide/listing page)
3. Focus on: destination, market overview, property types, price ranges, popular areas
4. Use null for any field not found in the source

**Required Output Format:**
```json
{
  "page_type": "general_guide",
  "destination": "string (e.g., 'Costa Rica Real Estate', 'Guanacaste Properties')",
  "destination_evidence": "exact quote",
  "overview": "string (general description of the real estate market)",
  "overview_evidence
INFO 2026-01-16 16:16:39,726 extraction Prompt preview (last 800 chars): entures","description":"Save your spots for the best experiences in Costa Rica. Sky Adventures offers unique experiences at incredible destinations, Monteverde and Arenal. Book adventures to enjoy our forests such as zip lining, nature challenge course, hanging bridges, aerial tram over the forest, tree climbing and more.","inLanguage":"en-US","isPartOf":{"@id":"https://skyadventures.travel/#/schema/WebSite"},"breadcrumb":{"@type":"BreadcrumbList","@id":"https://skyadventures.travel/#/schema/BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":"https://skyadventures.travel/","name":"Sky Adventures"},{"@type":"ListItem","position":2,"name":"Book Costa Rica Best Experiences"}]},"potentialAction":{"@type":"ReadAction","target":"https://skyadventures.travel/tickets/"}}]}

INFO 2026-01-16 16:16:39,726 extraction Starting LLM property extraction...
INFO 2026-01-16 16:16:46,252 _client HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
INFO 2026-01-16 16:16:46,255 extraction LLM extraction completed. Tokens used: 1319
INFO 2026-01-16 16:16:46,255 extraction Raw LLM response: {
  "page_type": "general_guide",
  "destination": "Costa Rica Real Estate",
  "destination_evidence": "null",
  "overview": "null",
  "overview_evidence": "null",
  "property_types_available": null,
  "types_evidence": "null",
  "price_range": {
    "min_usd": null,
    "max_usd": null,
    "typical_usd": null
  },
  "price_range_evidence": "null",
  "popular_areas": null,
  "areas_evidence": "null",
  "market_trends": null,
  "trends_evidence": "null",
  "featured_properties": null,
  "feature
INFO 2026-01-16 16:16:46,255 extraction Parsed JSON keys: ['page_type', 'destination', 'destination_evidence', 'overview', 'overview_evidence', 'property_types_available', 'types_evidence', 'price_range', 'price_range_evidence', 'popular_areas', 'areas_evidence', 'market_trends', 'trends_evidence', 'featured_properties', 'featured_evidence', 'total_properties_mentioned', 'total_evidence', 'investment_tips', 'tips_evidence', 'legal_considerations', 'legal_evidence', 'featured_items_count', 'extraction_confidence', 'confidence_reasoning']
INFO 2026-01-16 16:16:46,256 extraction Extraction successful. Confidence: 0.0
INFO 2026-01-16 16:16:46,256 extraction ğŸ”‘ OPENAI_API_KEY configured: Yes
INFO 2026-01-16 16:16:46,256 extraction ğŸ”‘ API Key length: 164 chars
INFO 2026-01-16 16:16:46,256 extraction ğŸ”‘ API Key preview: sk-proj-ex...
INFO 2026-01-16 16:16:46,266 extraction ğŸ“ Extractor initialized for content type: real_estate, page type: general
================================================================================
ğŸ” DEBUG EXTRACTION: https://skyadventures.travel/tickets/
================================================================================

ğŸ“¥ STEP 1: Scraping...
   âœ… HTML size: 120434 chars

ğŸ¯ STEP 2: Detecting content type...
   âœ… Content type: real_estate
   âœ… Confidence: 30.00%
   âœ… Method: default_fallback

ğŸ“„ STEP 3: Detecting page type...
   âœ… Page type: general
   âœ… Confidence: 85.00%
   âœ… Method: url_html_openai_agreed

ğŸ¤– STEP 4: Extracting with LLM...
   Parameters: content_type=real_estate, page_type=general

ğŸ“¦ EXTRACTED DATA (after LLM):
   Total keys: 17
   Keys: ['property_name', 'property_type', 'location', 'description', 'listing_id', 'internal_property_id', 'listing_status', 'date_listed', 'amenities', 'extraction_confidence', 'field_confidence', 'extracted_at', 'source_url', 'raw_html', 'tokens_used', 'content_type', 'page_type']

ğŸ” GUIDE FIELDS CHECK:
   âŒ destination: NOT FOUND
   âŒ overview: NOT FOUND
   âŒ property_types_available: NOT FOUND
   âŒ tour_types_available: NOT FOUND
   âŒ price_range: NOT FOUND
   âŒ featured_properties: NOT FOUND
   âŒ featured_tours: NOT FOUND
   âŒ market_trends: NOT FOUND

ğŸ§¹ STEP 5: Simulating evidence field removal...
   Found 0 evidence fields to remove
   After removal: 17 keys remain

ğŸ” GUIDE FIELDS AFTER EVIDENCE REMOVAL:
   âŒ destination: REMOVED
   âŒ overview: REMOVED
   âŒ property_types_available: REMOVED
   âŒ tour_types_available: REMOVED
   âŒ price_range: REMOVED
   âŒ featured_properties: REMOVED
   âŒ featured_tours: REMOVED
   âŒ market_trends: REMOVED

ğŸ“Š SUMMARY:
   Guide fields extracted: 0
   Guide fields survived cleaning: 0
   Loss: 0 fields

ğŸ”¬ STEP 6: Checking PropertyExtractor validation...
   Extractor initialized: content_type=real_estate, page_type=general
   âœ… Validation complete
   Keys after validation: 12
   Keys: ['property_name', 'property_type', 'location', 'description', 'listing_id', 'internal_property_id', 'listing_status', 'date_listed', 'amenities', 'extraction_confidence', 'field_confidence', 'extracted_at']

ğŸ” GUIDE FIELDS AFTER VALIDATION:
   âŒ destination: REMOVED BY VALIDATION
   âŒ overview: REMOVED BY VALIDATION
   âŒ property_types_available: REMOVED BY VALIDATION
   âŒ tour_types_available: REMOVED BY VALIDATION
   âŒ price_range: REMOVED BY VALIDATION
   âŒ featured_properties: REMOVED BY VALIDATION
   âŒ featured_tours: REMOVED BY VALIDATION
   âŒ market_trends: REMOVED BY VALIDATION

================================================================================
ğŸ DEBUG COMPLETE
================================================================================
